-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

-- Variables
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("Script started - Player found:", player.Name)

-- Configuration
local MAX_INVENTORY_SIZE = 235 -- When inventory reaches this â†’ Go to Plaza
local RETURN_THRESHOLD = 100 -- When inventory drops to this or below in Plaza â†’ Return to Garden
local AUTO_TELEPORT = true -- Set to false to disable automation

-- Wait for character
local character = player.Character or player.CharacterAdded:Wait()
local backpack = player:WaitForChild("Backpack")

print("Character and backpack loaded")

-- Find the remotes (Using Safe Call)
local plazaRemote
local mainWorldRemote

local success = pcall(function()
    plazaRemote = ReplicatedStorage:WaitForChild("GameEvents", 5)
        and ReplicatedStorage.GameEvents:WaitForChild("TradeWorld", 5)
        and ReplicatedStorage.GameEvents.TradeWorld:WaitForChild("TravelToTradeWorld", 5)
end)

local successMain = pcall(function()
    mainWorldRemote = ReplicatedStorage:WaitForChild("GameEvents", 5)
        and ReplicatedStorage.GameEvents:WaitForChild("TradeWorld", 5)
        and ReplicatedStorage.GameEvents.TradeWorld:WaitForChild("TravelToMainWorld", 5)
end)

if plazaRemote then print("âœ… Plaza Remote found") else warn("âš ï¸ Plaza Remote not found (Check game updates)") end
if mainWorldRemote then print("âœ… Main World Remote found") else warn("âš ï¸ Main World Remote not found") end

-- Teleport control
local joinInProgress = false
local currentLocation = "Unknown" 

-- ONE-TIME TELEPORT SYSTEM
local hasAutoTeleportedToPlaza = false 
local hasAutoTeleportedFromPlaza = false 

-- GUI CREATION
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "InventoryTeleportGui"
screenGui.ResetOnSpawn = false
screenGui.Enabled = true
screenGui.Parent = playerGui

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 280, 0, 210)
mainFrame.Position = UDim2.new(0.5, -140, 0.1, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(255, 170, 0)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Title
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 30)
titleLabel.Text = "Auto Pet Teleport"
titleLabel.BackgroundColor3 = Color3.fromRGB(255, 170, 0)
titleLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 16
titleLabel.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = titleLabel

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 28, 0, 20)
closeButton.Position = UDim2.new(1, -34, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.Parent = mainFrame
Instance.new("UICorner", closeButton).CornerRadius = UDim.new(0, 6)

-- Inventory Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 25)
statusLabel.Position = UDim2.new(0, 10, 0, 40)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Pets: Loading..."
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = mainFrame

-- Location Label
local locationLabel = Instance.new("TextLabel")
locationLabel.Size = UDim2.new(1, -20, 0, 20)
locationLabel.Position = UDim2.new(0, 10, 0, 65)
locationLabel.BackgroundTransparency = 1
locationLabel.Text = "ðŸ“ Location: Detecting..."
locationLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
locationLabel.Font = Enum.Font.GothamBold
locationLabel.TextXAlignment = Enum.TextXAlignment.Left
locationLabel.Parent = mainFrame

-- Auto Status Label
local autoStatusLabel = Instance.new("TextLabel")
autoStatusLabel.Size = UDim2.new(1, -20, 0, 18)
autoStatusLabel.Position = UDim2.new(0, 10, 0, 85)
autoStatusLabel.BackgroundTransparency = 1
autoStatusLabel.Text = "âš™ï¸ Auto: Monitoring..."
autoStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
autoStatusLabel.Font = Enum.Font.Gotham
autoStatusLabel.TextXAlignment = Enum.TextXAlignment.Left
autoStatusLabel.Parent = mainFrame

-- Teleport to Plaza Button
local teleportButton = Instance.new("TextButton")
teleportButton.Size = UDim2.new(0, 250, 0, 35)
teleportButton.Position = UDim2.new(0, 15, 0, 110)
teleportButton.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
teleportButton.Text = "Teleport to Plaza"
teleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
teleportButton.Font = Enum.Font.GothamBold
teleportButton.Parent = mainFrame
Instance.new("UICorner", teleportButton).CornerRadius = UDim.new(0, 6)

-- Return to Garden Button
local returnButton = Instance.new("TextButton")
returnButton.Size = UDim2.new(0, 250, 0, 35)
returnButton.Position = UDim2.new(0, 15, 0, 155)
returnButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
returnButton.Text = "Return to Garden"
returnButton.TextColor3 = Color3.fromRGB(255, 255, 255)
returnButton.Font = Enum.Font.GothamBold
returnButton.Parent = mainFrame
Instance.new("UICorner", returnButton).CornerRadius = UDim.new(0, 6)

-- --- FIXED INVENTORY FUNCTION ---
local function getInventoryCount()
    local count = 0
    
    -- CHECK 1: Look for a specific "Pets" folder inside the Player (Common in Simulators)
    local petsFolder = player:FindFirstChild("Pets")
    if petsFolder then
        return #petsFolder:GetChildren()
    end
    
    -- CHECK 2: Look for specific folders in ReplicatedStorage (Some games store data there)
    -- (You can add specific game folder logic here if needed)

    -- CHECK 3: Fallback to Backpack, but filter strictly
    if backpack then
        local items = backpack:GetChildren()
        for _, item in pairs(items) do
            -- Filter out scripts and hidden objects, only count Tools
            if item:IsA("Tool") then
                -- Optional: If your pets have a specific name, uncomment the line below
                -- if item.Name:find("Cat") or item.Name:find("Dog") then 
                    count = count + 1
                -- end
            end
        end
    end
    
    return count
end
-- ------------------------------

local function detectCurrentLocation()
    if Workspace:FindFirstChild("Plaza") or Workspace:FindFirstChild("TradeWorld") then
        return "Plaza"
    end
    
    -- Check height (Y Position) - Standard trick for multi-world games
    if character and character.PrimaryPart and character.PrimaryPart.Position.Y > 500 then
        return "Plaza" -- Often floating islands or sky maps
    end

    return "Garden"
end

local function updateGui()
    local currentCount = getInventoryCount()
    statusLabel.Text = "Pets: " .. currentCount .. "/" .. MAX_INVENTORY_SIZE
    
    if currentLocation == "Plaza" then
        locationLabel.Text = "ðŸ“ Location: Plaza"
        locationLabel.TextColor3 = Color3.fromRGB(100, 150, 255)
    else
        locationLabel.Text = "ðŸ“ Location: Garden"
        locationLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end
    
    -- Logic for Auto Status Text
    if isInventoryFull() then
        statusLabel.TextColor3 = Color3.fromRGB(255, 85, 85)
    else
        statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    end
end

function isInventoryFull()
    return getInventoryCount() >= MAX_INVENTORY_SIZE
end

-- Teleport Functions
local function teleportToPlaza()
    if currentLocation == "Plaza" then return end
    if joinInProgress then return end
    
    joinInProgress = true
    teleportButton.Text = "Teleporting..."
    
    if plazaRemote then
        pcall(function() plazaRemote:FireServer() end)
    else
        -- Fallback: Try to find a teleporter pad if remote fails
        print("Remote failed, looking for physical teleporter...")
    end
    
    task.wait(2)
    joinInProgress = false
    teleportButton.Text = "Teleport to Plaza"
end

local function teleportToGarden()
    if currentLocation == "Garden" then return end
    if joinInProgress then return end
    
    joinInProgress = true
    returnButton.Text = "Returning..."
    
    if mainWorldRemote then
        pcall(function() mainWorldRemote:FireServer() end)
    end
    
    task.wait(2)
    joinInProgress = false
    returnButton.Text = "Return to Garden"
end

-- Button Events
teleportButton.MouseButton1Click:Connect(teleportToPlaza)
returnButton.MouseButton1Click:Connect(teleportToGarden)
closeButton.MouseButton1Click:Connect(function() screenGui.Enabled = false end)

-- Update Loop
task.spawn(function()
    while true do
        task.wait(1)
        currentLocation = detectCurrentLocation()
        local count = getInventoryCount()
        
        updateGui()
        
        if AUTO_TELEPORT then
            -- Go to Plaza logic
            if currentLocation == "Garden" and count >= MAX_INVENTORY_SIZE and not hasAutoTeleportedToPlaza then
                hasAutoTeleportedToPlaza = true
                teleportToPlaza()
            end
            
            -- Return to Garden logic
            if currentLocation == "Plaza" and count <= RETURN_THRESHOLD and not hasAutoTeleportedFromPlaza then
                hasAutoTeleportedFromPlaza = true
                teleportToGarden()
            end
        end
    end
end)

-- Character Reset Handler
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    backpack = player:WaitForChild("Backpack")
    task.wait(1)
    currentLocation = detectCurrentLocation()
end)

print("=== âœ… FIXED SCRIPT LOADED ===")
-- DEBUG: Run this once to see what we are counting
task.spawn(function()
    task.wait(2)
    print("--- DEBUG INVENTORY CHECK ---")
    local petsFolder = player:FindFirstChild("Pets")
    if petsFolder then
        print("Found 'Pets' folder! Count:", #petsFolder:GetChildren())
    else
        print("No 'Pets' folder found. Checking Backpack...")
        if backpack then
            print("Backpack Items found:")
            for _, v in pairs(backpack:GetChildren()) do
                print("- " .. v.Name .. " (" .. v.ClassName .. ")")
            end
        end
    end
    print("-----------------------------")
end)
